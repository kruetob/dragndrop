<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drag'n'Drop</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f9f9f9;
        }

        h2 {
            margin-bottom: 10px;
            text-align: center;
            font-size: 1.5rem;
        }

        .zones {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            width: 100%;
            max-width: 800px;
        }

        .dropzone {
            min-height: 200px;
            border: 2px dashed #888;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #fff;
            position: relative;
            transition: background-color 0.3s;
            font-size: 1.2rem;
        }

        .dropzone.over {
            background-color: #eef;
        }

        .item {
            background: #4CAF50;
            color: white;
            padding: 20px;
            border-radius: 8px;
            cursor: grab;
            transition: transform 0.3s ease;
            position: relative;
            z-index: 1;
            font-size: 1.2rem;
            max-width: 250px;
            width: 100%;
            text-align: center;
            touch-action: none;
        }

        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 10px;
        }

        button {
            padding: 12px 20px;
            border-radius: 8px;
            border: none;
            background-color: #2196F3;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 1rem;
            min-width: 160px;
        }

        button:hover {
            background-color: #1976D2;
        }

        @media (min-width: 700px) {
            .zones {
                flex-direction: row;
            }

            .dropzone {
                flex: 1 1 300px;
            }
        }
    </style>
</head>

<body>

    <h2>Drag'n'Drop</h2>

    <div class="zones">
        <div id="zone1" class="dropzone">
            <div id="item" class="item" draggable="true">Verschieb mich!</div>
        </div>
        <div id="zone2" class="dropzone"></div>
    </div>

    <div class="buttons">
        <button id="moveBtn">Animiert verschieben</button>
        <button id="resetBtn">Zurücksetzen</button>
    </div>

    <script>
        const item = document.getElementById("item");
        const zone1 = document.getElementById("zone1");
        const zone2 = document.getElementById("zone2");
        const moveBtn = document.getElementById("moveBtn");
        const resetBtn = document.getElementById("resetBtn");

        let dragged = false;
        let isAnimating = false; // Flag für laufende Animationen
        item.setAttribute("draggable", "true");

        // ===== Maus-Drag =====
        item.addEventListener("dragstart", (e) => {
            e.dataTransfer.setData("text/plain", "item");
            // Das Element wird sofort unsichtbar, sodass es nicht als Duplikat erscheint
            setTimeout(() => {
                item.style.visibility = "hidden";
            }, 0);
            dragged = true;
        });

        item.addEventListener("dragend", () => {
            // Bei Dragend wieder sichtbar machen
            item.style.visibility = "visible";
            item.style.transform = "scale(1)";
            dragged = false;
        });

        item.addEventListener("transitionend", () => {
            item.style.transition = "";
        });

        [zone1, zone2].forEach((zone) => {
            zone.addEventListener("dragover", (e) => {
                e.preventDefault();
                zone.classList.add("over");
            });
            zone.addEventListener("dragleave", () => {
                zone.classList.remove("over");
            });
            zone.addEventListener("drop", (e) => {
                e.preventDefault();
                zone.appendChild(item);
                // Sichtbarkeit sicherstellen, falls sie noch versteckt war
                item.style.visibility = "visible";
                zone.classList.remove("over");
                scaleEffect();
            });
        });

        document.body.addEventListener("drop", (e) => {
            if (!e.target.classList.contains("dropzone") && dragged) {
                zone1.appendChild(item);
                item.style.visibility = "visible";
            }
        });

        // ===== Touch-Drag =====
        let offsetX, offsetY;

        item.addEventListener("touchstart", (e) => {
            const touch = e.touches[0];
            offsetX = touch.clientX - item.getBoundingClientRect().left;
            offsetY = touch.clientY - item.getBoundingClientRect().top;
            item.style.position = "fixed";
            item.style.zIndex = "1000";
            item.style.transform = "scale(1.05)";
            item.style.width = item.offsetWidth + "px";
        });

        item.addEventListener("touchmove", (e) => {
            const touch = e.touches[0];
            item.style.left = (touch.clientX - offsetX) + "px";
            item.style.top = (touch.clientY - offsetY) + "px";

            [zone1, zone2].forEach(zone => {
                const rect = zone.getBoundingClientRect();
                if (touch.clientX >= rect.left && touch.clientX <= rect.right &&
                    touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
                    zone.classList.add("over");
                } else {
                    zone.classList.remove("over");
                }
            });
        });

        item.addEventListener("touchend", (e) => {
            [zone1, zone2].forEach(zone => zone.classList.remove("over"));

            const touch = e.changedTouches[0];
            const dropZone = [zone1, zone2].find(zone => {
                const rect = zone.getBoundingClientRect();
                return touch.clientX >= rect.left && touch.clientX <= rect.right &&
                    touch.clientY >= rect.top && touch.clientY <= rect.bottom;
            });

            item.style.transition = "all 0.3s ease";

            if (dropZone) {
                const rect = dropZone.getBoundingClientRect();
                item.style.left = rect.left + rect.width / 2 - item.offsetWidth / 2 + "px";
                item.style.top = rect.top + rect.height / 2 - item.offsetHeight / 2 + "px";

                item.addEventListener("transitionend", () => {
                    dropZone.appendChild(item);
                    resetItemStyle();
                    scaleEffect();
                }, { once: true });
            } else {
                const rect = zone1.getBoundingClientRect();
                item.style.left = rect.left + rect.width / 2 - item.offsetWidth / 2 + "px";
                item.style.top = rect.top + rect.height / 2 - item.offsetHeight / 2 + "px";

                item.addEventListener("transitionend", () => {
                    zone1.appendChild(item);
                    resetItemStyle();
                }, { once: true });
            }
        });

        function resetItemStyle() {
            item.style.position = "relative";
            item.style.left = "";
            item.style.top = "";
            item.style.zIndex = "1";
            item.style.transform = "scale(1)";
            item.style.width = "";
            item.style.transition = "";
        }

        // ===== Animiertes Verschieben (Button) =====
        moveBtn.addEventListener("click", () => {
            if (isAnimating) return; // Verhindert Mehrfachanimationen
            isAnimating = true;
            moveBtn.disabled = true;

            const sourceZone = item.parentElement;
            const targetZone = sourceZone === zone1 ? zone2 : zone1;

            const itemRect = item.getBoundingClientRect();
            const targetRect = targetZone.getBoundingClientRect();

            const ghost = item.cloneNode(true);
            ghost.style.position = "fixed";
            ghost.style.left = itemRect.left + "px";
            ghost.style.top = itemRect.top + "px";
            ghost.style.margin = "0";
            ghost.style.zIndex = "1000";
            ghost.style.pointerEvents = "none";
            ghost.style.width = itemRect.width + "px";

            document.body.appendChild(ghost);
            sourceZone.removeChild(item);

            requestAnimationFrame(() => {
                ghost.style.transition = "transform 0.6s ease";
                const deltaX = targetRect.left + targetRect.width / 2 - (itemRect.left + itemRect.width / 2);
                const deltaY = targetRect.top + targetRect.height / 2 - (itemRect.top + itemRect.height / 2);
                ghost.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
            });

            ghost.addEventListener("transitionend", () => {
                targetZone.appendChild(item);
                document.body.removeChild(ghost);
                scaleEffect();
                moveBtn.disabled = false;
                isAnimating = false;
            }, { once: true });
        });

        resetBtn.addEventListener("click", () => {
            zone1.appendChild(item);
        });

        function scaleEffect() {
            item.style.transition = "transform 150ms ease-out";
            item.style.transform = "scale(1.02)";
            setTimeout(() => {
                item.style.transform = "scale(1)";
            }, 150);
        }
    </script>

</body>

</html>
